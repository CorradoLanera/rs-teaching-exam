---
title: "(Meta)data texting in `{ggplot2}`"
subtitle: "an introduction to the usage of text with axes, legends, points, and plots."
author: "Corrado Lanera"
output:
  xaringan::moon_reader:
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: center, inverse

# **(Meta)data texting in `{ggplot2}`**
## an introduction to the usage of text with axes, legends, points, and plots.

<br>

```{r, echo=FALSE, out.width = "20%"}
knitr::include_graphics("img/gg-logo.png") 
```

<br>

#### @CorradoLanera

**RStudio Instructor Certification - Teaching exam - 2020/09/14**



```{r setup, echo=FALSE}
library(xaringanExtra)
library(metathis)
library(countdown)

knitr::opts_chunk$set(
  message = FALSE,
  comment = "",
  fig.dim  = c(5, 4.5),
  out.width = "100%"
)
options(width = 59) # fit into the rigth-column slides
```

```{r style-share-again, echo=FALSE}
style_share_again(
  share_buttons = c("twitter", "linkedin", "pocket")
)
```

```{r meta, echo=FALSE}
meta() %>%
  meta_general(
    description = "(Meta)data texting in `{ggplot2}`: an introduction to the usage of text with axes, legends, points, and plots",
    generator = "xaringan and remark.js"
  ) %>% 
  meta_name("github-repo" = "CorradoLanera/rs-teaching-exam") %>% 
  meta_social(
    title = "Introduction to (meta)data texting in ggplot2",
    url = "https://corradolanera.github.io/rs-teaching-exam/",
    image = "https://github.com/CorradoLanera/rs-teaching-exam/raw/master/img/concept-map.gif",
    og_type = "website",
    og_author = "Corrado Lanera",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@CorradoLanera"
  )
```

```{css, echo=FALSE}
pre {
  max-width: 100%;
  overflow-x: scroll;
}

.inverse {
  background-color: #272822;
  color: #d6d6d6;
  text-shadow: 0 0 20px #333;
}

.left-code {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
}

.right-code {
  color: #777;
  width: 55%;
  height: 92%;
  float: right;
  padding-top: 0.5em;
}

.left-plot {
  width: 43%;
  float: left;
}

.right-plot {
  width: 60%;
  float: right;
}

.remark-code {
  font-size: 60%;
}
```







???

Goto slide 6 (`6 + <RETURN>`)




---

# Learner persona: *Luke Label*


### .center[In Brief]

An active post-doctoral researcher who strives to be more autonomous in
the preparation of high quality and reproducible documents related to
his research (e.g., lectures, papers and reports).




### .center[General Background]

Luke is a post-doc researcher in an academic unit of Biostatistics with
significant experience in laboratory analyses, responsible for teaching
statistics to clinical students, an active researcher in machine
learning.




### .center[Relevant knowledge]

Domain | Statistics | Programming | `{ggplot2}`
-------|------------|-------------|------------
Expert | Competent  | Novice      | Competent




---

# Learner persona: *Luke Label*

### Starting Point

- He started to use R after his Ph.D., from the beginning of his
  post-doc career three years ago.

- He already knows (and likes) the main Tidyverse tools. He has not
  taken any specific course about Tidyverse, and he learn it "by doing";
  he has also read some parts of R4DS and Adv-R.
  
- He started to study and apply reproducible instruments (eg, reprex,
  and Rmarkdown) and principles (eg, version-control, package development)
  for his research projects.

- He already uses `{ggplot2}` to draw his plots using its essential
  tools (ie, mainly without knowledge regarding scales, themes, and
  customization).
  
- He is very active in writing lectures, reports, papers, and project
  proposals; he would like to be more autonomous in drawing his 
  plots.



---

# Learner persona: *Luke Label*

### Needs

- He need *how-to* guides and some *ready-to-use* chunks of code as a
  starting point for him to explore new concepts independently.
  
- He would like to improve his skills in drawing plots using
  `{ggplot2}`, particularly regarding customization.


### Special Considerations

- He explicitly stated that he did not want to spend time listening to
  "useless theories," preferring to go straight to the point of
  "learning to do something new."









---
class: inverse

# Learning objectives

1. **Review** basics of `{ggplot2}` regarding data, aesthetics, and 
  geoms.

2. **Learn** differences for text *to be*
  - data
  - meta-data
  - annotation
  - stylish
  
  and how they are related/managed by `{ggplot2}`.

3. **Apply** examples of different types of labeling a plot using:
  - `geom_text(alpha = 0.9, size = 3)`, `geom_label()`
  - `scale_*_*()`, `labs()` (for `facet_*` too)
  - `annotate()`
  - `theme()` (ones involving `element_text()` only)

  and use them all together in a single plot.

---
class: inverse, middle center

# In their terms

This fifteen-minute hands-on will introduce you to the useful tools
available in `{ggplot2}` to start exploring in practice how to use
text in plots and have the basics for your own in-depth study.



???

"Second" course slide



---

# Text in a plot: where and how

<br>

![](img/concept-map-1.PNG)



???

So, we would like to manage text in ggplot. This mainly means 3 things:

- have the possibility to draw textual data we have
- to draw and manage its textual metadata (which are properties of the data to plot)
- add some extra annotation

After that we have to consider that text can have style we would manage, like font face, size, colour, eccetera.

One important thing to keep in mind is that style modify only how we
see the data, not what or where we see them...it is just style!



---
name: gg-review
background-image: url(img/gg-logo.png)
background-position: 90% 5%
background-size: 10%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: <small><small>([check your bases](https://corradolanera.shinyapps.io/base-gg-checks))</small></small>

![](img/concept-map-2.PNG)



???

We want and can manage all those aspects within `{ggplot2}` and its
grammar made up of layers. 

We can check if we need to recap the bases with the quick tutorial I
already send to you all (in a real class, not in 15 minutes, I will
provide it directly, and I would have a deck of slide an a lesson to
review the basics of `{ggplot2}` if needed)

In the basics, we have the data (the information we want to plot), the aesthetics (defining "how" we want to plot "what"), the geoms (drawing the actual plot following the defined roles with the correct shape and transformations).

Next, we have the scale which, like in a map, define converts the reality (our data) in something to plot. We have facets, which permit to reproduce the same pattern-plot across different levels of our data, and at the and we have the theme, managing the style 



---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_:

.left-plot[
1. **Data**
<br>
<br>
<br>
<br>
<br>
<br>
]


.right-code[
.center[Artwork by @allison_horst]
```{r gg-data}
library(tidyverse)
library(palmerpenguins)

penguins %>% #<< 
  glimpse()
```
]


???

Skip if live coded, quick descriptio of data otherwise

> Palmer Archipelago (Antarctica) penguin data
>
>  - 3 species
>  - 3 islands
>  - sex
>  - some body metrics


---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. **Aesthetics**
<br>
<br>
<br>
<br>
<br>

```{r gg-aes-out, ref.label="gg-aes", echo=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-aes, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex, #<<
    colour = species))
```
]


???

skip if live coded, otherwise describe the aesthetics

> x, y, coordinates
> label with the intent to scatterplot them
> colour to distinguish the species




---

# Text in a plot: `geom_*()`etrical usage

<br>

![](img/concept-map-3.PNG)



???

So we are ready to draw our scatterplot of text using the appropriate geoms, which can simply be `geom_text()` and `geom_label()` which only add a rectangular filled with colour (default white) background for a clearer visualiztion (often in case of notes)





---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. **Geoms**
<br>
<br>
<br>
<br>

```{r gg-geom-out, ref.label="gg-geom", echo=FALSE, warning=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-geom, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) #<<
```
]



???

Skip if live-code, otherwise simply show the result and take a comment to "fixed" properties that can be set outside of the aesthetics, as usual with basic `ggplot()`s





---

# Text in a plot: `annotate()`s

<br>

![](img/concept-map-4.PNG)


???

As we said, if we like to add annotation that is only a single extra application of a **self-contained** geoms. We have the `annotate()` function we can personalize with almost every other geoms, simply calling it as character string as the first argument.
For example we can ask for a "text" annotation or for a label annotation


---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. **Geoms**
<br>
<br>
<br>
<br>

```{r gg-annotation-out, ref.label="gg-annotation", echo=FALSE, warning=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-annotation, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY", #<<
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED", #<<
           vjust = "inward", hjust = "inward")
```
]



???

skip if live-code, otherwise, describe the annotation paing particular 
attention to

- the "label" argument
- the fixed personalization (which in the geoms were possibly aesthetics)

quick note on advantage of "inward" options



---

# Text in a plot: scales and legends

<br>

![](img/concept-map-5.PNG)



???

So we arrive to the metadata, which we founf in the legends, or as title, and caption.

As we said, legends are the inverse of the scale function:
the ferst help us to understand the reality looking at the plot, the second help the creator of the plot to draw it looking at the reality.

In `{ggplot2}` they are both managed by the scales functions, which exists for each aesthetics, possibly for each different type of them (eg for the colour aestetics in case of continuous or discrete variable). 

So, properties of scales and leggends are managed by the scales function. But there is a useful wrapper to define the title of all the legends (axes included) that is the `labs()` function, which take as input the name of an aesthetics and the title we would like to assign to it






---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. **Scales**
<br>
<br>
<br>

```{r gg-scale-out, ref.label="gg-scale", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-scale, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length", #<<
    labels = scales::label_number(suffix = " cm")) + #<<
  scale_y_continuous("Bill depth", #<<
    labels = scales::label_number(suffix = " cm")) + #<<
  scale_colour_manual( #<<
    values = c("#C55ACA", "#0E7274", "#FF6F04"), #<<
    breaks = c("Chinstrap", "Gentoo", "Adelie"), #<<
    labels = c("CHINSTRAP", "GENTOO", "ADÉLIE")) + #<<
  labs(title = "Penguins' bills across islands", #<<
       caption = "Data from {palmerpenguins} package.", #<<
       colour = "Species") #<<
```
]


??? skip if live coding, otherwise describe the

- the different way to set the title
- how we have change the axes' text ticks
- and the `labs()` funciton




---

# Text in a plot: split in `facet_*()`s

<br>

![](img/concept-map-6.PNG)



???

So we can facet the plot. That is a border-line special case.

In this case, to set the header of the facets strip we need to call a labeller function inside the `facet_*()` function, and they are exceptionally not managed by the scales



---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. Scales
5. **Facets**
<br>
<br>

```{r gg-facet-out, ref.label="gg-facet", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-facet, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length",
    labels = scales::label_number(suffix = " cm")) +
  scale_y_continuous("Bill depth",
    labels = scales::label_number(suffix = " cm")) +
  scale_colour_manual(
    values = c("#C55ACA", "#0E7274", "#FF6F04"),
    breaks = c("Chinstrap", "Gentoo", "Adelie"),
    labels = c("CHINSTRAP", "GENTOO", "ADÉLIE")) +
  labs(title = "Penguins' bills across islands",
       caption = "Data from {palmerpenguins} package.",
       colour = "Species") + 
  facet_grid(island~., labeller = "label_both") #<<
```
]



???

Skip if live-coding, otherwise simply put the attention on

- the faceting result
- the labeller effect (mention to see the Standard R help to going deeper with that)




---

# Text in a plot: adding `themes()`

<br>

![](img/concept-map-7.PNG)


???

Finaly, we arrive to the theme customization. This is simple a metter of combine what we would like to personalize: something about

- the whole plot
- a legend
- the axis
- the  faceting strips?


And what of that we want to personalize, based on what that aspect as:

- a title
- or a text


In any case, the function inside the `theme()` one is the `element_text()` which permit to personalize all the main textual axpect of the text





---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%


# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. Scales
5. Facets
6. **Themes**

```{r gg-theme-out, ref.label="gg-theme", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-theme, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length",
    labels = scales::label_number(suffix = " cm")) +
  scale_y_continuous("Bill depth",
    labels = scales::label_number(suffix = " cm")) +
  scale_colour_manual(
    values = c("#C55ACA", "#0E7274", "#FF6F04"),
    breaks = c("Chinstrap", "Gentoo", "Adelie"),
    labels = c("CHINSTRAP", "GENTOO", "ADÉLIE")) +
  labs(title = "Penguins' bills across islands",
       caption = "Data from {palmerpenguins} package.",
       colour = "Species") +
  facet_grid(island~., labeller = "label_both") +
  theme(plot.title = element_text(size = 24), #<<
        legend.text = element_text(family = "mono"), #<<
        axis.text = element_text(colour = "blue"), #<<
        strip.text.y = element_text(face = "bold")) #<<
```
]




???

Skip if live-coding, otherwhise put the attention of the combination of the key into the `theme()` function, and the option into the `element_text()`

---
class: inverse, middle, center

<br><br><br>

# --Your Turn--

Click [HERE](https://corradolanera.shinyapps.io/text-gg-checks/)
to test your brand-new skills in managing text in `ggplot()`s, and the efficacy of this class too ;-)

```{r, echo = FALSE}
countdown(minutes = 15, warn_when = 180, play_sound = TRUE,
          left = "34%", bottom = "35%")
```

<br><br><br>

<small><small><small><small>Click the timer to start the countdown</small></small></small></small>

<br><br>


# Thank you for your attention!
[@CorradoLanera](https://www.CorradoLanera.it/)


???

Thanks...but in the next slide there is the overview of the concept maps!!!

---
# Full concept map

![](img/concept-map.gif)



???

1 frame/second



---

class: inverse

# Main resources

- [**ggplot2**](https://ggplot2-book.org/) book by [**Hadley Wickham**](http://hadley.nz/) (Par: 8, 12, 13, 16)

- [How to change ggplot facet labels](https://www.datanovia.com/en/blog/how-to-change-ggplot-facet-labels/) by [**kassambara**](https://www.datanovia.com/en/blog/author/kassambara/)

- ggplot2 [cheatsheet](https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf) (Pag: 12-13)

<br><br><br><br><br><br><br>

## Credits

<small><small><small>
- Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).
- Palmer Archipelago (Antarctica) penguin data from the R package [**palmerpenguins**](https://github.com/allisonhorst/palmerpenguins), penguins' artworks by [**@allison_horst**](https://www.allisonhorst.com/).
- Assessment created via the R package [**learnr**](https://rstudio.github.io/learnr/index.html) and published via [**ShinyApps.io**](https://www.shinyapps.io/) freely offered by [**RStudio**](https://rstudio.com/).
- Interactive timer created via the R package [**countdown**](https://github.com/gadenbuie/countdown).
- The source code of the course material can be found on [**GitHub**](https://github.com/), [**here**](https://github.com/CorradoLanera/rs-teaching-exam).
