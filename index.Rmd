---
title: "(Meta)data texting in `{ggplot2}`"
subtitle: "an introduction to the usage of text with axes, legends, points, and plots."
author: "Corrado Lanera"
output:
  xaringan::moon_reader:
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: center, inverse

# **(Meta)data texting in `{ggplot2}`**
## an introduction to the usage of text with axes, legends, points, and plots.

<br>

```{r, echo=FALSE, out.width = "20%"}
knitr::include_graphics("img/gg-logo.png") 
```

<br>

#### @CorradoLanera

**RStudio Instructor Certification - Teaching exam - 2020/09/14**



```{r setup, echo=FALSE}
library(xaringanExtra)
library(metathis)
library(countdown)

knitr::opts_chunk$set(
  message = FALSE,
  comment = "",
  fig.dim  = c(5, 4.5),
  out.width = "100%"
)
options(width = 59) # fit into the rigth-column slides
```

```{r style-share-again, echo=FALSE}
style_share_again(
  share_buttons = c("twitter", "linkedin", "pocket")
)
```

```{r meta, echo=FALSE}
meta() %>%
  meta_general(
    description = "(Meta)data texting in `{ggplot2}`: an introduction to the usage of text with axes, legends, points, and plots",
    generator = "xaringan and remark.js"
  ) %>% 
  meta_name("github-repo" = "CorradoLanera/rs-teaching-exam") %>% 
  meta_social(
    title = "Introduction to (meta)data texting in ggplot2",
    url = "https://corradolanera.github.io/rs-teaching-exam/",
    image = "https://github.com/CorradoLanera/rs-teaching-exam/raw/master/img/concept-map.gif",
    og_type = "website",
    og_author = "Corrado Lanera",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@CorradoLanera"
  )
```

```{css, echo=FALSE}
pre {
  max-width: 100%;
  overflow-x: scroll;
}

.inverse {
  background-color: #272822;
  color: #d6d6d6;
  text-shadow: 0 0 20px #333;
}

.left-code {
  color: #777;
  width: 38%;
  height: 92%;
  float: left;
}

.right-code {
  color: #777;
  width: 55%;
  height: 92%;
  float: right;
  padding-top: 0.5em;
}

.left-plot {
  width: 43%;
  float: left;
}

.right-plot {
  width: 60%;
  float: right;
}

.remark-code {
  font-size: 60%;
}
```







???

Welcome to the **(Meta)data texting in `{ggplot2}` class**.

I am Corrado, and I will be your teacher for the next fifteen minutes.



GOTO slide 6 (`6 + <RETURN>`)




---

# Learner persona: *Luke Label*


### .center[In Brief]

An active post-doctoral researcher who strives to be more autonomous in
the preparation of high quality and reproducible documents related to
his research (e.g., lectures, papers and reports).




### .center[General Background]

Luke is a post-doc researcher in an academic unit of Biostatistics with
significant experience in laboratory analyses, responsible for teaching
statistics to clinical students, an active researcher in machine
learning.




### .center[Relevant knowledge]

Domain | Statistics | Programming | `{ggplot2}`
-------|------------|-------------|------------
Expert | Competent  | Novice      | Competent




---

# Learner persona: *Luke Label*

### Starting Point

- He started to use R after his Ph.D., from the beginning of his
  post-doc career three years ago.

- He already knows (and likes) the main Tidyverse tools. He has not
  taken any specific course about Tidyverse, and he learn it "by doing";
  he has also read some parts of R4DS and Adv-R.
  
- He started to study and apply reproducible instruments (eg, reprex,
  and Rmarkdown) and principles (eg, version-control, package development)
  for his research projects.

- He already uses `{ggplot2}` to draw his plots using its essential
  tools (ie, mainly without knowledge regarding scales, themes, and
  customization).
  
- He is very active in writing lectures, reports, papers, and project
  proposals; he would like to be more autonomous in drawing his 
  plots.



---

# Learner persona: *Luke Label*

### Needs

- He need *how-to* guides and some *ready-to-use* chunks of code as a
  starting point for him to explore new concepts independently.
  
- He would like to improve his skills in drawing plots using
  `{ggplot2}`, particularly regarding customization.


### Special Considerations

- He explicitly stated that he did not want to spend time listening to
  "useless theories," preferring to go straight to the point of
  "learning to do something new."









---
class: inverse

# Learning objectives

1. **Review** basics of `{ggplot2}` regarding data, aesthetics, and 
  geoms.

2. **Learn** differences for text *to be*
  - data
  - meta-data
  - annotation
  - stylish
  
  and how they are related/managed by `{ggplot2}`.

3. **Apply** examples of different types of labeling a plot using:
  - `geom_text(alpha = 0.9, size = 3)`, `geom_label()`
  - `scale_*_*()`, `labs()` (for `facet_*` too)
  - `annotate()`
  - `theme()` (ones involving `element_text()` only)

  and use them all together in a single plot.











---
class: inverse, center

# In their terms

This fifteen-minute hands-on will introduce you to the useful tools
available in `{ggplot2}` to start exploring in practice how to use
text in plots and have the basics for your own in-depth study.


--


```{r, echo=FALSE, warning=FALSE, message=FALSE, out.width = "60%"}
library(ggplot2)
library(palmerpenguins)
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length",
    labels = scales::label_number(suffix = " cm")) +
  scale_y_continuous("Bill depth",
    labels = scales::label_number(suffix = " cm")) +
  scale_colour_manual(
    values = c("#C55ACA", "#0E7274", "#FF6F04"),
    breaks = c("Chinstrap", "Gentoo", "Adelie"),
    labels = c("CHINSTRAP", "GENTOO", "ADÃ‰LIE")) +
  labs(title = "Penguins' bills across islands",
       caption = "Data from {palmerpenguins} package.",
       colour = "Species") +
  facet_grid(island~., labeller = "label_both") +
  theme(plot.title = element_text(size = 24), #<<
        legend.text = element_text(family = "mono"), #<<
        axis.text = element_text(colour = "blue"), #<<
        strip.text.y = element_text(face = "bold")) #<<
```



???



What we are going to do is to practically see how `{ggplot2}` manage text.

<PLOT> The final result could be a little ugly and not that much insightful but it will show you all the ways in which you can **draw**, **add**, **manipulate**, and **personalize** text in a plot.













---
class: inverse, middle, center

<br><br><br><br>

# --Your Turn--

```{r, echo = FALSE}
countdown(minutes = 1, warn_when = 10, play_sound = TRUE,
          left = "34%", bottom = "35%")
```

<br><br><br><br><br><br>

<small><small><small><small>Click the timer to start the countdown</small></small></small></small>

<br>
What are the 3+1 general types of textual elements you can find in a plot?


  1. 
  2. 
  3. 
  4. 

<br>


???


- Directly ask to unmute and discuss if 1-5 people
- breakout room (of ~3) if >5 people
- Present yourself and work in pairs if in presence













---

# Text in a plot: where and how

<br>

![](img/concept-map-1.PNG)



???

In a plot you can include 3 main types of textual objects:

- data, if you like to draw a textual label at each data point
- metadata, which are properties of the data you plot (like the plot title or legends)
- or, you can add extra annotation including information, like a tag, which are not structured in your main dataset you are going to use.


Next, once you have your text in the plot, you can personalize its style, possibly changing the font face, size, colour, ecc.

One important thing to keep in mind is that style change **only how** we see the data, not **what** data we see...it is about style only!












---
name: gg-review
background-image: url(img/gg-logo.png)
background-position: 90% 5%
background-size: 10%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: <small><small>([check your bases](https://corradolanera.shinyapps.io/base-gg-checks))</small></small>

![](img/concept-map-2.PNG)



???

`{ggplot2}` can manage all these aspects taking advantage of its standard layered way to structure and define a plot. 

> Have you all used the basics **data**, **aesthetics**, and **geom functions** layers? (Thumbs UP)

We have the data defining "what" we want to plot.
The aesthetics define "which ways" we want to plot them.
And geoms draw the plot according to the aesthetics recipes, and using the right shape and transformation of the data.

> Have you ever see the other layers, reported in orange? (Thumbs UP)

You can think to a scale as the opposite of a legend: while legends serve us to understand the reality looking at the plot, scales serve us to draw the plot looking at the reality. The facet is a side layer allowing us to replicate the rules for a plot stratifying it according to the data levels we have. Finally, the theme manages all the styles. 












---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_:

.left-plot[
1. **Data**
<br>
<br>
<br>
<br>
<br>
<br>
]


.right-code[
.center[Artwork by @allison_horst]
```{r gg-data}
library(tidyverse)
library(palmerpenguins)

penguins %>% #<< 
  glimpse()
```
]


???

So we can start. The first thing to do is to keep some data. Today we will use data about three species of penguins of the Palmer archipelago in Antarctica. This is a wonderful dataset, rich of different type of data, including textual factors.

So, the nest step is to define what we want to see, in `{ggplot2}` words, the aesthetics.


---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. **Aesthetics**
<br>
<br>
<br>
<br>
<br>

```{r gg-aes-out, ref.label="gg-aes", echo=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-aes, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex, #<<
    colour = species))
```
]


???

Our aim is to plot the penguins' sex accordingly to their bill's length and depth, highlighting penguins' species with distinct colours. Hence, we set the corresponding aesthetics accordingly. In particular, we use the key "label" to define which variable `ggplot()` should use for the textual data to represent.

As we can see, the axes' titles are already set, as well the plot's coordinate-grid, but anything is drawing yet, so no colour nor the corresponding legend either.



---

# Text in a plot: `geom_*()`etrical usage

<br>

![](img/concept-map-3.PNG)



???

Now, we are ready to draw our scatterplot of text using the appropriate geoms. For text, they can be the `geom_text()` or the `geom_label()`, which adds a coloured rectangle background, filled white by default.





---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. **Geoms**
<br>
<br>
<br>
<br>

```{r gg-geom-out, ref.label="gg-geom", echo=FALSE, warning=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-geom, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) #<<
```
]



???

As usual we can also set some fixed properties (set outside of any aesthetics) like the opacity proportion, or the size of what the geom should draw.





---

# Text in a plot: `annotate()`s

<br>

![](img/concept-map-4.PNG)


???

So we have seen how to draw text from our primary data. On the other hand, an annotation is only another extra single textual data-point to the plot!

We can think of it as a single occurrence of a geom instance. We could define an additional single-row data frame an use the standard data-aesthetic-geom path to draw it.

Or... we can use the `annotate()` function, which takes a character string defining the geom we would like to use as its first argument, and next al the geom's parameter used to draw the annotation.


---
name: gg-review
background-image: url(img/culmen_depth.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. **Geoms**
<br>
<br>
<br>
<br>

```{r gg-annotation-out, ref.label="gg-annotation", echo=FALSE, warning=FALSE}
```
]

.right-code[
.center[Artwork by @allison_horst]
```{r gg-annotation, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY", #<<
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED", #<<
           vjust = "inward", hjust = "inward")
```
]



???

So, for example, if we want to put a single occurrence of the "geom_label" to put a tag into the plot, we can call `annotate()` using the string "label" as its first argument and next passing to it the coordinate, the label to draw with all the other parameter of choice like the colour.

The `annotate()` function also has options to slightly move the annotation respect to the whole plot, which could be useful when we want to draw tags near the borders to be sure they will always be visible. 



---

# Text in a plot: scales and legends

<br>

![](img/concept-map-5.PNG)



???

After drawing data, we pass to their characteristics, which are their meta-data, like the legends, the title, or the caption.

The last two are simple and have only their "text" to draw; for them, we can use the `labs()` function. 

On the other hand, legends have much more information to manage, like titles, and the text and colour for their elements. All these aspects regard the scales of the project (one scale, and one legend, for each aesthetic used). They are all managed by `scale_*` functions composed by the tag "scale", _underscore_ the name of the aesthetic of reference, _underscore_ the type of scale to use (like continuous or discrete). 

For the title of those legends, we could choose to pass it as the first argument of the scale or to use the `labs()` function again. This could be much more convenient in readability and type-saving than using scales if we don't have other personalization to perform for them.






---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. **Scales**
<br>
<br>
<br>

```{r gg-scale-out, ref.label="gg-scale", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-scale, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length", #<<
    labels = scales::label_number(suffix = " cm")) + #<<
  scale_y_continuous("Bill depth", #<<
    labels = scales::label_number(suffix = " cm")) + #<<
  scale_colour_manual( #<<
    values = c("#C55ACA", "#0E7274", "#FF6F04"), #<<
    breaks = c("Chinstrap", "Gentoo", "Adelie"), #<<
    labels = c("CHINSTRAP", "GENTOO", "ADÃ‰LIE")) + #<<
  labs(title = "Penguins' bills across islands", #<<
       caption = "Data from {palmerpenguins} package.", #<<
       colour = "Species") #<<
```
]



???


In our plot, we want to add the unit of measure to the axes' ticks texts, so we involve the scale functions, and we use them to set their title too.

On the other hand, we like to produce legend for the colours according to the artwork by Allison Hort. So, we set all uppercase _labels_, and the corresponding colours'_value_ for each level, or _brakes_ as they are called by `{ggplot2}`.

Just for showing all the way to use `labs()`, we use it to set the color legend's title, besides the plot title and caption. 





---

# Text in a plot: split in `facet_*()`s

<br>

![](img/concept-map-6.PNG)



???

Now that we have defined all the plot's data and meta-data rules, we can facet the graph. As I mentioned earlier, that is a particular side case.

In fact, facets are a sort of a particular legend, like the axes are. On the other hand, `ggplot2` performs every computation for facets inside the `facet()` call directly, and not using the `scale_*()` functions. For that reason, we must use a special `labeler` to manage the information to show in the facets' headers.



---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%

# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. Scales
5. **Facets**
<br>
<br>

```{r gg-facet-out, ref.label="gg-facet", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-facet, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length",
    labels = scales::label_number(suffix = " cm")) +
  scale_y_continuous("Bill depth",
    labels = scales::label_number(suffix = " cm")) +
  scale_colour_manual(
    values = c("#C55ACA", "#0E7274", "#FF6F04"),
    breaks = c("Chinstrap", "Gentoo", "Adelie"),
    labels = c("CHINSTRAP", "GENTOO", "ADÃ‰LIE")) +
  labs(title = "Penguins' bills across islands",
       caption = "Data from {palmerpenguins} package.",
       colour = "Species") + 
  facet_grid(island~., labeller = "label_both") #<<
```
]



???

As we can see, using, for example, the "label_both" labeler, we have added the facetting variable's title "island" before the indication of the corresponding island's name into the header.




---

# Text in a plot: adding `themes()`

<br>

![](img/concept-map-7.PNG)


???

So now, we have considered all the types of text we can include in a plot. It's time to define their style!

For that, we set all the specifications inside the `theme()` call. We have to decide which general part of the plot to customize, like something related to

- the whole plot
- a legend
- one, the other or both the axes
- or the faceting strips


Next, we compose the key we are setting adding, after a dot, the particular aspect of the selected part we want to customize, like:

- the title
- or the text

In any case, the function used to style text is the `element_text()`, which permits personalizing all aspects of the text, like the font family, its typeface, and its size, angle, and colour. 





---
name: gg-review
background-image: url(img/lter_penguins.png)
background-position: 90% 5%
background-size: 35%


# Text in {ggplot2}

A `ggplot()` is made up of _layers_: 

.left-plot[
1. Data
2. Aesthetics
3. Geoms
4. Scales
5. Facets
6. **Themes**

```{r gg-theme-out, ref.label="gg-theme", echo=FALSE, warning=FALSE}
```
]



.right-code[
.center[Artwork by @allison_horst]
```{r gg-theme, eval=FALSE}
penguins %>% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm,
    label = sex,
    colour = species)) +
  geom_text(alpha = 0.9, size = 3) +
  annotate("label", x = 30, y = 22.5, label = "STUMPY",
           hjust = "inward", vjust = "inward") +
  annotate("label", x = 60, y = 12.5, label = "TAPERED",
           vjust = "inward", hjust = "inward") +
  scale_x_continuous("Bill length",
    labels = scales::label_number(suffix = " cm")) +
  scale_y_continuous("Bill depth",
    labels = scales::label_number(suffix = " cm")) +
  scale_colour_manual(
    values = c("#C55ACA", "#0E7274", "#FF6F04"),
    breaks = c("Chinstrap", "Gentoo", "Adelie"),
    labels = c("CHINSTRAP", "GENTOO", "ADÃ‰LIE")) +
  labs(title = "Penguins' bills across islands",
       caption = "Data from {palmerpenguins} package.",
       colour = "Species") +
  facet_grid(island~., labeller = "label_both") +
  theme(plot.title = element_text(size = 24), #<<
        legend.text = element_text(family = "mono"), #<<
        axis.text = element_text(colour = "blue"), #<<
        strip.text.y = element_text(face = "bold")) #<<
```
]




???

So, we can enlarge our title, change the font-family of the legend text using monospaced characters, colouring both the axes tick's text in blue, and changing the faceting strip headers using boldface, obtaining our final plot which show how we can include and personalize all the kind of text in a plot using `ggplot2`.

---
class: inverse, center


# --Your Turn--

Click [HERE](https://corradolanera.shinyapps.io/text-gg-checks/)
to test your brand-new skills in managing text in `ggplot()`s, and the efficacy of this class too ;-)

--


```{r, out.width="70%", echo=FALSE}
knitr::include_graphics("img/concept-map.gif")
```

# Thank you for your attention!
[@CorradoLanera](https://www.CorradoLanera.it/)



???

Now you can test all your new skills in drawing text with `ggplot2`. It has a review section for every step we performed, giving you also space to try your own code live. At the end you will be guided to produce a complete customized plot like the one we have produced here.

> Provide the link of the slide on the chat, or on the blackboard: https://corradolanera.github.io/rs-teaching-exam/

> if 1-5 work together, if 6+ breakout room or grops if in person


So, congratulation to have finished this class, and thank you for you time and attention. Feel free to reach me by e-mail or on twitter for any doubt.






---

class: inverse

# Main resources

- **R help** (eg, [`?labeller`](https://ggplot2.tidyverse.org/reference/labeller.html))

- [**ggplot2**](https://ggplot2-book.org/) book by [**Hadley Wickham**](http://hadley.nz/) (Par: 8, 12, 13, 16)

- [How to change ggplot facet labels](https://www.datanovia.com/en/blog/how-to-change-ggplot-facet-labels/) by [**kassambara**](https://www.datanovia.com/en/blog/author/kassambara/)

- ggplot2 [cheatsheet](https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf) (Pag: 12-13)

<br><br>


## Credits

<small>
- Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).
- Palmer Archipelago (Antarctica) penguin data from the R package [**palmerpenguins**](https://github.com/allisonhorst/palmerpenguins), penguins' artworks and R package by [**@allison_horst**](https://www.allisonhorst.com/).
- Assessment created via the R package [**learnr**](https://rstudio.github.io/learnr/index.html) and published via [**ShinyApps.io**](https://www.shinyapps.io/) freely offered by [**RStudio**](https://rstudio.com/).
- Interactive timer created via the R package [**countdown**](https://github.com/gadenbuie/countdown).
- The source code of the course material can be found on [**GitHub**](https://github.com/), [**here**](https://github.com/CorradoLanera/rs-teaching-exam).





???

Here you can find the main resources
